// We embed the worker script here to avoid issues with loading external worker files in single-page structures.
// This is the standard gif.worker.js content.
const workerScript = `
!function(t){function e(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){var n,i;n=r(1),i=function(t){var e,r,i,o;return e=new n(t.width,t.height),0===t.index?e.writeHeader():e.firstFrame=!1,e.setTransparent(t.transparent),e.setRepeat(t.repeat),e.setDelay(t.delay),e.setQuality(t.quality),e.addFrame(t.data),t.last&&e.finish(),r=e.stream(),i=e.out.data,o=0,r.on("data",function(t){return i.push(t),o+=t.length}),r.on("end",function(){var r;return r=new Uint8Array(o),r.set(i[0],0),i.slice(1).forEach(function(t,e){return r.set(t,i[e].length)}),self.postMessage(r,[r.buffer])})},self.onmessage=function(t){return i(t.data)}},function(t,e,r){function n(t,e){this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.image=null,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.usedEntry=new Array,this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10,this.out=new i}var i;i=r(2),n.prototype={create:function(t,e){var r,n;return n=new Uint8Array(t*e*3),r=new Uint8Array(t*e),this.width=t,this.height=e,this.pixels=n,this.indexedPixels=r,null},setDelay:function(t){return this.delay=Math.round(t/10)},setDispose:function(t){return t>=0&&(this.dispose=t),null},setRepeat:function(t){return this.repeat=t,null},setTransparent:function(t){return this.transparent=t,null},addFrame:function(t){if(this.image=t,this.getImagePixels(),this.analyzePixels(),this.firstFrame){this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()}return this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame=!1,this.writePixels(),this.write(),null},finish:function(){return this.out.writeByte(59),null},setQuality:function(t){return t<1&&(t=1),this.sample=t,null},write:function(){return null},writeByte:function(t){return this.out.writeByte(t),null},writeShort:function(t){return this.out.writeByte(255&t),this.out.writeByte(t>>8&255),null},writeBytes:function(t){return this.out.writeBytes(t),null},writeString:function(t){return this.out.writeString(t),null},writeLSD:function(){return this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(240|this.palSize),this.writeByte(0),this.writeByte(0),null},writePalette:function(){var t,e,r;for(this.out.writeBytes(this.colorTab),r=768-this.colorTab.length,t=0;r>t;t++)e=t,this.out.writeByte(0);return null},writeNetscapeExt:function(){return this.out.writeByte(33),this.out.writeByte(255),this.out.writeByte(11),this.out.writeString("NETSCAPE2.0"),this.out.writeByte(3),this.out.writeByte(1),this.writeShort(this.repeat),this.out.writeByte(0),null},writeGraphicCtrlExt:function(){var t,e;return this.out.writeByte(33),this.out.writeByte(249),this.out.writeByte(4),null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&this.dispose),e<<=2,this.out.writeByte(0|e|0|t),this.writeShort(this.delay),this.out.writeByte(this.transIndex),this.out.writeByte(0),null},writeImageDesc:function(){return this.out.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.out.writeByte(0),null},writePixels:function(){var t;return t=new o(this.width,this.height,this.indexedPixels,this.colorDepth),t.encode(this.out),null},getImagePixels:function(){var t,e,r,n,i,o,s;for(i=this.width,o=this.height,this.pixels=new Uint8Array(i*o*3),n=this.image,t=0,s=0;o>s;s++)for(e=0;i>e;e++)r=s*i*4+4*e,this.pixels[t++]=n[r],this.pixels[t++]=n[r+1],this.pixels[t++]=n[r+2];return null},analyzePixels:function(){var t,e,r,n,i,o,a,h,u,l,f,c,p,d,w,y,g,v,b,m,x;for(g=this.pixels.length,e=g/3,this.indexedPixels=new Uint8Array(e),a=new s(this.pixels,this.sample),a.buildColormap(),this.colorTab=a.getColormap(),h=0,u=0;g>u;u+=3)l=this.pixels[u],f=this.pixels[u+1],c=this.pixels[u+2],p=a.map(l,f,c),this.indexedPixels[h++]=p,this.usedEntry[p]=!0;for(this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent&&(this.transIndex=a.map(this.transparent>>16&255,this.transparent>>8&255,255&this.transparent),d=this.usedEntry[this.transIndex],d||(this.transIndex=0)),w=0;w<this.colorTab.length;w+=3)y=w/3,v=w,this.usedEntry[y]||(b=3*this.transIndex,m=b,x=b,this.colorTab[v]=this.colorTab[b],this.colorTab[v+1]=this.colorTab[m],this.colorTab[v+2]=this.colorTab[x]);return null}},t.exports=n},function(t,e){function r(){this.data=[],this.len=0}r.prototype={writeByte:function(t){return this.data.push(t),this.len++,null},writeBytes:function(t){var e,r;for(r=t.length,e=0;r>e;e++)this.writeByte(t[e]);return null},writeString:function(t){var e,r;for(r=t.length,e=0;r>e;e++)this.writeByte(t.charCodeAt(e));return null},getData:function(){return this.data},stream:function(){return this.data}},t.exports=r},function(t,e){function r(t,e){this.init(t,e)}var n={};r.prototype={init:function(t,e){this.width=t,this.height=e,this.accum=new Uint8Array(256),this.htab=new Int32Array(n.HSIZE),this.codetab=new Int32Array(n.HSIZE),this.cur_accum=0,this.cur_bits=0,this.free_ent=0,this.maxcode=0,this.clear_flg=!1,this.g_init_bits=0,this.ClearCode=0,this.EOFCode=0},encode:function(t){var e,r,i,o;for(this.outs=t,this.g_init_bits=8,i=this.width*this.height,this.cur_pixel=0,this.a_count=0,this.cl_block(i),e=this.g_init_bits+1,this.clear_flg=!1,this.n_bits=e,this.maxcode=n.MAXCODE(e),this.ClearCode=1<<this.g_init_bits,this.EOFCode=this.ClearCode+1,this.free_ent=this.ClearCode+2,this.ent=this.nextPixel(),o=this.g_init_bits,this.hsize=n.HSIZE,this.hshift=0,r=65536;r<this.hsize;r*=2)this.hshift++;for(this.hshift=8-this.hshift,this.hsize_reg=this.hsize,this.resetCodeTable(),this.output(this.ClearCode);(r=this.nextPixel())!=n.EOF;)if(this.fcode(r),e=this.ent<<n.BITS|r,this.htab[e]===this.cur_pixel){if(this.ent=this.codetab[e],this.free_ent>n.MAXMAXCODE){this.output(this.ClearCode);continue}}else if(this.output(this.ent),this.ent=r,this.free_ent<n.MAXMAXCODE){if(this.codetab[e]=this.free_ent++,this.htab[e]=this.cur_pixel,this.free_ent>=this.maxcode&&this.maxcode<n.MAXMAXCODE){this.maxcode*=2,this.n_bits++;continue}}else this.clear_block(),this.free_ent=this.ClearCode+2,this.clear_flg=!0,this.n_bits=this.g_init_bits+1,this.maxcode=n.MAXCODE(this.n_bits);this.output(this.ent),this.output(this.EOFCode)},nextPixel:function(){return this.cur_pixel===this.indexed_pixels.length?n.EOF:(this.cur_pixel++,this.indexed_pixels[this.cur_pixel-1])},output:function(t){return this.cur_accum&=n.MASKS[this.cur_bits],this.cur_bits>0?this.cur_accum|=t<<this.cur_bits:this.cur_accum=t,this.cur_bits+=this.n_bits;for(;this.cur_bits>=8;)this.char_out(255&this.cur_accum),this.cur_accum>>=8,this.cur_bits-=8;if(this.free_ent>this.maxcode||this.clear_flg)if(this.clear_flg)this.maxcode=n.MAXCODE(this.n_bits=this.g_init_bits+1),this.clear_flg=!1;else{if(this.n_bits++,this.n_bits==n.BITS)return this.maxcode=n.MAXMAXCODE,null;this.maxcode=n.MAXCODE(this.n_bits)}return t==this.EOFCode?(this.cur_bits>0&&this.char_out(255&this.cur_accum),this.flush_char()):null},cl_block:function(t){return this.indexed_pixels=t,null},fcode:function(t){var e,r,i,o,s,a;if(this.hsize_reg<65536){for(e=this.ent<<n.BITS|t,i=e<<this.hshift^e,this.htab[i]===this.cur_pixel?(s=i,a=!1):this.htab[i]<0?(s=i,a=!0):(r=i-256,0>r&&(r+=this.hsize_reg),o=i-r,0>o&&(o+=this.hsize_reg),s=i,a=!1);;){if(a){if(this.htab[s]===-1)return void(this.codetab[s]=this.free_ent++,this.htab[s]=this.cur_pixel);if(s-=r,0>s&&(s+=this.hsize_reg),s===i)return}else if(this.htab[s]===this.cur_pixel)return this.ent=this.codetab[s],void 0;if(this.htab[s]===-1)return void(this.codetab[s]=this.free_ent++,this.htab[s]=this.cur_pixel);if(s-=r,0>s&&(s+=this.hsize_reg),s===i)return}}else this.htab[e]=this.cur_pixel,this.codetab[e]=this.free_ent++},resetCodeTable:function(){var t;for(t=0;t<this.hsize;t++)this.htab[t]=-1;return null},char_out:function(t){return this.accum[this.a_count++]=t,this.a_count>=254&&this.flush_char(),null},flush_char:function(){return this.a_count>0&&(this.outs.writeByte(this.a_count),this.outs.writeBytes(this.accum),this.a_count=0),null},clear_block:function(){return this.resetCodeTable(),this.free_ent=this.ClearCode+2,this.clear_flg=!0,this.n_bits=this.g_init_bits+1,this.maxcode=n.MAXCODE(this.n_bits),null}},n.MAXCODE=function(t){return(1<<t)-1},n.EOF=-1,n.BITS=12,n.HSIZE=5003,n.MASKS=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],n.MAXMAXCODE=1<<n.BITS,t.exports=r},function(t,e){function r(t,e){var r,n,i;for(this.pixels=t,this.samplefac=e,this.netindex=new Int32Array(256),r=0;256>r;r++)this.netindex[r]=r<<4;for(this.bias=new Int32Array(256),this.freq=new Int32Array(256),this.radpower=new Int32Array(32),r=0;256>r;r++)this.bias[r]=0,this.freq[r]=256;for(r=0;32>r;r++)this.radpower[r]=1024*(1<<28-r);this.network=new Int32Array(1024),this.biasshift=0,i=this.pixels.length,n=3*this.samplefac,this.lengthcount=i/n,this.alphadec=30+(this.lengthcount-1)/3}var n,i,o,s,a;n=499,i=491,o=487,s=503,a=3*s,r.prototype={buildColormap:function(){var t,e,r,s,a,h,u,l,f,c;for(t=this.pixels,e=t.length,r=this.lengthcount,s=3*this.samplefac,h=0;h<e;h+=s)u=t[h]<<4,l=t[h+1]<<4,f=t[h+2]<<4,this.learn(u,l,f);for(c=this.network,h=0;256>h;h++)c[4*h+3]=h;for(h=0;h<256;h++)this.unbiasnet();for(h=0;h<e;h+=s)u=t[h]<<4,l=t[h+1]<<4,f=t[h+2]<<4,this.alterneigh(u,l,f);for(h=0;h<256;h++)this.unbiasnet();for(h=0;h<e;h+=s)u=t[h]<<4,l=t[h+1]<<4,f=t[h+2]<<4,this.altersingle(u,l,f);for(h=0;h<256;h++)c[4*h+3]=h},getColormap:function(){var t,e,r,n;for(t=new Uint8Array(768),e=this.network,r=0;256>r;r++)n=e[4*r+3],t[3*n]=e[4*r],t[3*n+1]=e[4*r+1],t[3*n+2]=e[4*r+2];return t},learn:function(t,e,r){var s,a,h,u,l,f,c,p;for(s=this.network,h=this.contest(t,e,r),a=h.best,u=h.bestd,l=s[4*a],f=s[4*a+1],c=s[4*a+2],s[4*a]-=l-t>>n,s[4*a+1]-=f-e>>n,s[4*a+2]-=c-r>>n,p=Math.abs(u-this.bias[a]),this.bias[a]+=p<<10,this.bias[a]-=p,this.freq[a]-=this.freq[a]>>10,this.freq[a]+=64,a++;256>a;)l=s[4*a],f=s[4*a+1],c=s[4*a+2],p=Math.abs(this.dist(t,e,r,a)-this.bias[a]),this.bias[a]+=p<<10,this.bias[a]-=p,this.freq[a]-=this.freq[a]>>10,this.freq[a]+=64,a++;for(a=h.best-1;a>=0;)l=s[4*a],f=s[4*a+1],c=s[4*a+2],p=Math.abs(this.dist(t,e,r,a)-this.bias[a]),this.bias[a]+=p<<10,this.bias[a]-=p,this.freq[a]-=this.freq[a]>>10,this.freq[a]+=64,a--},unbiasnet:function(){var t,e,r;for(t=this.network,e=0;256>e;e++)r=this.freq[e],this.bias[e]<<=6,r-=r>>10,this.bias[e]+=r<<10,this.freq[e]=r,t[4*e]=t[4*e]>>6,t[4*e+1]=t[4*e+1]>>6,t[4*e+2]=t[4*e+2]>>6,t[4*e]>=256&&(t[4*e]=255),t[4*e+1]>=256&&(t[4*e+1]=255),t[4*e+2]>=256&&(t[4*e+2]=255)},alterneigh:function(t,e,r){var n,o,s,a,h,u,l,f,c,p,d,w,y,g,v,b;for(n=this.network,o=this.contest(t,e,r),s=o.best,a=o.bestd,h=s-1,u=s+1,l=a,f=a,c=1;32>c&&(h>=0||256>u);)h>=0&&(p=n[4*h],d=n[4*h+1],w=n[4*h+2],y=Math.abs(t-p)+Math.abs(e-d)+Math.abs(r-w),y+=Math.abs(y-l)>>1,y<l&&(l=y),g=this.radpower[c],n[4*h]-=p-t>>g,n[4*h+1]-=d-e>>g,n[4*h+2]-=w-r>>g,h--),256>u&&(p=n[4*u],d=n[4*u+1],w=n[4*u+2],v=Math.abs(t-p)+Math.abs(e-d)+Math.abs(r-w),v+=Math.abs(v-f)>>1,v<f&&(f=v),b=this.radpower[c],n[4*u]-=p-t>>b,n[4*u+1]-=d-e>>b,n[4*u+2]-=w-r>>b,u++),c++},altersingle:function(t,e,r){var n,s,a,h,u,l;for(n=this.contest(t,e,r),s=n.best,a=n.bestd,h=this.network,u=h[4*s],l=h[4*s+1],n=h[4*s+2],h[4*s]-=u-t>>o,h[4*s+1]-=l-e>>o,h[4*s+2]-=n-r>>o,s++;256>s;)u=h[4*s],l=h[4*s+1],n=h[4*s+2],u-=u-t>>i,l-=l-e>>i,n-=n-r>>i,h[4*s]=u,h[4*s+1]=l,h[4*s+2]=n,s++;for(s=n.best-1;s>=0;)u=h[4*s],l=h[4*s+1],n=h[4*s+2],u-=u-t>>i,l-=l-e>>i,n-=n-r>>i,h[4*s]=u,h[4*s+1]=l,h[4*s+2]=n,s--},contest:function(t,e,r){var n,o,s,a,h,u,l,f,c,p,d,w;for(n=this.network,o=2147483647,s=o,a=-1,h=this.bias,u=this.freq,l=0;256>l;l++)f=n[4*l],c=n[4*l+1],p=n[4*l+2],d=Math.abs(f-t)+Math.abs(c-e)+Math.abs(p-r),w=d-h[l],w<o&&(o=w,a=l),d-=h[l]>>10,d<s&&(s=d);return{best:a,bestd:o}},dist:function(t,e,r,n){var i,o,s,a,h;return i=this.network,o=i[4*n],s=i[4*n+1],a=i[4*n+2],Math.abs(o-t)+Math.abs(s-e)+Math.abs(a-r)},map:function(t,e,r){var n,i;return n=this.contest(t,e,r),i=n.best,this.freq[i]>>=1,this.freq[i]++,i}},t.exports=r}])
`;

export const getGifWorkerUrl = () => {
    const blob = new Blob([workerScript], { type: 'application/javascript' });
    return URL.createObjectURL(blob);
};
